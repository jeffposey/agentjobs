{% extends "base.html" %}

{% block title %}Dashboard - AgentJobs{% endblock %}

{% block content %}
<div class="space-y-6">
    {% if waiting_tasks %}
    <div class="bg-gradient-to-r from-red-900/20 to-orange-900/20 border-2 border-red-500/50 rounded-lg p-6">
        <div class="flex items-start gap-4">
            <div class="text-4xl" aria-hidden="true">ðŸ””</div>
            <div class="flex-1">
                <h2 class="text-xl font-bold text-red-300 mb-2">
                    {{ waiting_tasks|length }} {{ 'Task' if waiting_tasks|length == 1 else 'Tasks' }} Waiting for Your Review
                </h2>
                <p class="text-dark-muted mb-4">These tasks need human input to proceed.</p>
                <div class="space-y-2">
                    {% for task in waiting_tasks[:3] %}
                    <a href="/tasks/{{ task.id }}" class="block bg-dark-surface hover:bg-dark-border border border-dark-border rounded-lg p-4 transition">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex-1">
                                <h3 class="font-medium text-dark-text">{{ task.title }}</h3>
                                <p class="text-sm text-dark-muted mt-1">
                                    {{ (task.human_summary or task.description[:150]) | truncate(160, True, 'â€¦') }}
                                </p>
                            </div>
                            <span class="px-2 py-1 bg-red-900 text-red-200 text-xs rounded whitespace-nowrap">
                                Waiting
                            </span>
                        </div>
                    </a>
                    {% endfor %}
                    {% if waiting_tasks|length > 3 %}
                    <a href="/tasks?status=waiting_for_human" class="block text-center text-sm text-blue-400 hover:text-blue-300 pt-2">
                        View all {{ waiting_tasks|length }} waiting tasks â†’
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="grid grid-cols-1 md:grid-cols-5 gap-6">
        <div class="bg-dark-surface p-6 rounded-lg border border-dark-border">
            <div class="text-sm text-dark-muted">Waiting for Human</div>
            <div class="text-3xl font-bold mt-2 text-orange-400">{{ stats.waiting_for_human or 0 }}</div>
        </div>
        <div class="bg-dark-surface p-6 rounded-lg border border-dark-border">
            <div class="text-sm text-dark-muted">In Progress</div>
            <div class="text-3xl font-bold mt-2">{{ stats.in_progress }}</div>
        </div>
        <div class="bg-dark-surface p-6 rounded-lg border border-dark-border">
            <div class="text-sm text-dark-muted">Blocked</div>
            <div class="text-3xl font-bold mt-2 text-red-400">{{ stats.blocked }}</div>
        </div>
        <div class="bg-dark-surface p-6 rounded-lg border border-dark-border">
            <div class="text-sm text-dark-muted">Completed</div>
            <div class="text-3xl font-bold mt-2 text-green-400">{{ stats.completed }}</div>
        </div>
        <div class="bg-dark-surface p-6 rounded-lg border border-dark-border">
            <div class="text-sm text-dark-muted">Total</div>
            <div class="text-3xl font-bold mt-2">{{ stats.total }}</div>
        </div>
    </div>

    {% if stats.total == 0 %}
    <div class="bg-gradient-to-r from-blue-900/20 to-purple-900/20 border-2 border-blue-500/30 rounded-lg p-6">
        <div class="flex items-start gap-4">
            <div class="text-4xl" aria-hidden="true">ðŸš€</div>
            <div class="flex-1">
                <h2 class="text-xl font-bold text-blue-300 mb-2">Getting Started with AgentJobs</h2>
                <p class="text-dark-muted mb-4">No tasks yet. Here's how to get rolling:</p>

                <div class="space-y-3 text-sm">
                    <div>
                        <strong class="text-dark-text">For Humans:</strong>
                        <pre class="bg-dark-bg rounded p-2 mt-1 text-xs">agentjobs create --title "My First Task" --priority high</pre>
                    </div>

                    <div>
                        <strong class="text-dark-text">For AI Agents:</strong>
                        <pre class="bg-dark-bg rounded p-2 mt-1 text-xs">from agentjobs import TaskClient
client = TaskClient()
task = client.get_next_task()
client.mark_in_progress(task.id, agent="agent-name")</pre>
                    </div>

                    <div class="mt-4">
                        <a href="/docs" class="text-blue-400 hover:text-blue-300 underline">View Full Documentation â†’</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="bg-dark-surface rounded-lg border border-dark-border">
        <div class="p-6 border-b border-dark-border flex items-center justify-between">
            <h2 class="text-xl font-semibold">Active Tasks</h2>
            <a href="/tasks" class="text-sm text-blue-400 hover:text-blue-300 transition">View all</a>
        </div>
        <div class="p-4 space-y-4">
            {% if active_tasks %}
                {% for task in active_tasks %}
                {% with card_link="/tasks/" ~ task.id %}
                    {% include "components/task_card.html" %}
                {% endwith %}
                {% endfor %}
            {% else %}
            <div class="text-dark-muted text-sm text-center border border-dashed border-dark-border rounded-lg p-6 bg-dark-bg/40">
                No active tasks right now. Enjoy the calm!
            </div>
            {% endif %}
        </div>
    </div>

    <div class="bg-dark-surface rounded-lg border border-dark-border">
        <div class="p-6 border-b border-dark-border">
            <h2 class="text-xl font-semibold">Recent Updates</h2>
        </div>
        <div class="divide-y divide-dark-border">
            {% if recent_updates %}
                {% for update in recent_updates %}
                <div class="p-4">
                    <div class="flex flex-wrap items-center text-sm text-dark-muted gap-2">
                        <span class="font-medium text-dark-text">{{ update.task_title }}</span>
                        <span>â€¢</span>
                        <span>{{ update.timestamp.strftime('%Y-%m-%d %H:%M') }}</span>
                        <span>â€¢</span>
                        <span>{{ update.author }}</span>
                    </div>
                    <p class="mt-2 text-sm text-dark-muted">{{ update.summary }}</p>
                </div>
                {% endfor %}
            {% else %}
            <div class="p-6 text-dark-muted text-sm">
                No recent updates. Check back soon.
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
