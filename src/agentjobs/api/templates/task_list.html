{% extends "base.html" %}

{% block title %}Tasks - AgentJobs{% endblock %}

{% block content %}
<div x-data="taskList()" x-cloak>
    <div class="bg-dark-surface rounded-lg border border-dark-border p-6 mb-6">
        <div class="flex flex-col md:flex-row gap-4">
            <div class="flex-1">
                <input
                    type="text"
                    x-model="search"
                    placeholder="Search tasks..."
                    class="w-full bg-dark-bg border border-dark-border rounded-lg px-4 py-2 text-dark-text focus:outline-none focus:border-blue-500"
                >
            </div>
            <select x-model="statusFilter" class="bg-dark-bg border border-dark-border rounded-lg px-4 py-2">
                <option value="all">All Status</option>
                <option value="planned">Planned</option>
                <option value="in_progress">In Progress</option>
                <option value="blocked">Blocked</option>
                <option value="under_review">Under Review</option>
                <option value="completed">Completed</option>
                <option value="archived">Archived</option>
            </select>
            <select x-model="priorityFilter" class="bg-dark-bg border border-dark-border rounded-lg px-4 py-2">
                <option value="all">All Priorities</option>
                <option value="critical">Critical</option>
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
            </select>
        </div>
    </div>

    <div class="bg-dark-surface rounded-lg border border-dark-border overflow-x-auto">
        <table class="min-w-full divide-y divide-dark-border">
            <thead>
                <tr class="bg-dark-bg">
                    <th class="px-6 py-3 text-left text-xs font-medium text-dark-muted uppercase tracking-wider">Task</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-dark-muted uppercase tracking-wider">Status</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-dark-muted uppercase tracking-wider">Priority</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-dark-muted uppercase tracking-wider">Assigned</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-dark-muted uppercase tracking-wider">Updated</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-dark-border">
                {% for task in tasks %}
                <tr
                    class="hover:bg-dark-border transition cursor-pointer"
                    onclick="window.location.href='/tasks/{{ task.id }}'"
                    x-show="matches($el.dataset)"
                    data-title="{{ task.title | lower | e }}"
                    data-status="{{ task.status | e }}"
                    data-priority="{{ task.priority | e }}"
                >
                    <td class="px-6 py-4 min-w-[220px]">
                        <div class="font-medium">{{ task.title }}</div>
                        <div class="text-sm text-dark-muted">{{ task.category }}</div>
                    </td>
                    <td class="px-6 py-4">
                        {% include "components/status_badge.html" %}
                    </td>
                    <td class="px-6 py-4">
                        {% include "components/priority_badge.html" %}
                    </td>
                    <td class="px-6 py-4 text-sm">{{ task.assigned_to or 'â€”' }}</td>
                    <td class="px-6 py-4 text-sm text-dark-muted">
                        {{ task.updated.strftime('%Y-%m-%d %H:%M') }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% if not tasks %}
        <div class="p-6 text-sm text-dark-muted">No tasks have been created yet.</div>
        {% endif %}
    </div>
</div>

<script>
    function taskList() {
        return {
            search: '',
            statusFilter: 'all',
            priorityFilter: 'all',
            matches(dataset) {
                const title = (dataset.title || '').toLowerCase();
                const status = dataset.status || 'planned';
                const priority = dataset.priority || 'medium';
                const searchTerm = this.search.trim().toLowerCase();
                const searchMatches = searchTerm === '' || title.includes(searchTerm);
                const statusMatches = this.statusFilter === 'all' || status === this.statusFilter;
                const priorityMatches = this.priorityFilter === 'all' || priority === this.priorityFilter;
                return searchMatches && statusMatches && priorityMatches;
            }
        };
    }
</script>
{% endblock %}
